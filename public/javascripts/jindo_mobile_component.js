/**
 * Jindo Mobile Component
 * @version 1.2.0
 * NHN_Library:Jindo_Mobile_Component-1.2.0;JavaScript Mobile Components for Jindo;
 */


jindo.Component=jindo.$Class({_htEventHandler:null,_htOption:null,$init:function(){var aInstance=this.constructor.getInstance();aInstance.push(this);this._htEventHandler={};this._htOption={};this._htOption._htSetter={};},option:function(sName,vValue){switch(typeof sName){case"undefined":return this._htOption;case"string":if(typeof vValue!="undefined"){if(sName=="htCustomEventHandler"){if(typeof this._htOption[sName]=="undefined"){this.attach(vValue);}else{return this;}}
this._htOption[sName]=vValue;if(typeof this._htOption._htSetter[sName]=="function"){this._htOption._htSetter[sName](vValue);}}else{return this._htOption[sName];}
break;case"object":for(var sKey in sName){if(sKey=="htCustomEventHandler"){if(typeof this._htOption[sKey]=="undefined"){this.attach(sName[sKey]);}else{continue;}}
this._htOption[sKey]=sName[sKey];if(typeof this._htOption._htSetter[sKey]=="function"){this._htOption._htSetter[sKey](sName[sKey]);}}
break;}
return this;},optionSetter:function(sName,fSetter){switch(typeof sName){case"undefined":return this._htOption._htSetter;case"string":if(typeof fSetter!="undefined"){this._htOption._htSetter[sName]=jindo.$Fn(fSetter,this).bind();}else{return this._htOption._htSetter[sName];}
break;case"object":for(var sKey in sName){this._htOption._htSetter[sKey]=jindo.$Fn(sName[sKey],this).bind();}
break;}
return this;},fireEvent:function(sEvent,oEvent){oEvent=oEvent||{};var fInlineHandler=this['on'+sEvent],aHandlerList=this._htEventHandler[sEvent]||[],bHasInlineHandler=typeof fInlineHandler=="function",bHasHandlerList=aHandlerList.length>0;if(!bHasInlineHandler&&!bHasHandlerList){return true;}
aHandlerList=aHandlerList.concat();oEvent.sType=sEvent;if(typeof oEvent._aExtend=='undefined'){oEvent._aExtend=[];oEvent.stop=function(){if(oEvent._aExtend.length>0){oEvent._aExtend[oEvent._aExtend.length-1].bCanceled=true;}};}
oEvent._aExtend.push({sType:sEvent,bCanceled:false});var aArg=[oEvent],i,nLen;for(i=2,nLen=arguments.length;i<nLen;i++){aArg.push(arguments[i]);}
if(bHasInlineHandler){fInlineHandler.apply(this,aArg);}
if(bHasHandlerList){var fHandler;for(i=0,fHandler;(fHandler=aHandlerList[i]);i++){fHandler.apply(this,aArg);}}
return!oEvent._aExtend.pop().bCanceled;},attach:function(sEvent,fHandlerToAttach){if(arguments.length==1){jindo.$H(arguments[0]).forEach(jindo.$Fn(function(fHandler,sEvent){this.attach(sEvent,fHandler);},this).bind());return this;}
var aHandler=this._htEventHandler[sEvent];if(typeof aHandler=='undefined'){aHandler=this._htEventHandler[sEvent]=[];}
aHandler.push(fHandlerToAttach);return this;},detach:function(sEvent,fHandlerToDetach){if(arguments.length==1){jindo.$H(arguments[0]).forEach(jindo.$Fn(function(fHandler,sEvent){this.detach(sEvent,fHandler);},this).bind());return this;}
var aHandler=this._htEventHandler[sEvent];if(aHandler){for(var i=0,fHandler;(fHandler=aHandler[i]);i++){if(fHandler===fHandlerToDetach){aHandler=aHandler.splice(i,1);break;}}}
return this;},detachAll:function(sEvent){var aHandler=this._htEventHandler;if(arguments.length){if(typeof aHandler[sEvent]=='undefined'){return this;}
delete aHandler[sEvent];return this;}
for(var o in aHandler){delete aHandler[o];}
return this;}});jindo.Component.factory=function(aObject,htOption){var aReturn=[],oInstance;if(typeof htOption=="undefined"){htOption={};}
for(var i=0,el;(el=aObject[i]);i++){oInstance=new this(el,htOption);aReturn[aReturn.length]=oInstance;}
return aReturn;};jindo.Component.getInstance=function(){if(typeof this._aInstance=="undefined"){this._aInstance=[];}
return this._aInstance;};if(typeof jindo.m=="undefined"&&typeof Node!="undefined"){var ___Old__addEventListener___=Node.prototype.addEventListener;Node.prototype.addEventListener=function(type,listener,useCapture){var callee=arguments.callee;if(callee&&type==="click"&&this.tagName==="A"){(this.___listeners___||(this.___listeners___=[])).push({listener:listener,useCapture:useCapture});}
return ___Old__addEventListener___.apply(this,arguments);};var ___Old__removeEventListener___=Node.prototype.removeEventListener;Node.prototype.removeEventListener=function(type,listener,useCapture){var callee=arguments.callee;if(callee&&type==="click"&&this.tagName==="A"){if(this.___listeners___){this.___listeners___.pop();}}
return ___Old__removeEventListener___.apply(this,arguments);};}
jindo.m=(function(){var __M__=jindo.$Class({$init:function(){this._initVar();this._initDeviceInfo();this._attachEvent();},_initVar:function(){this.MOVETYPE={0:'hScroll',1:'vScroll',2:'dScroll',3:'tap',4:'longTap',5:'doubleTap',6:'pinch',7:'rotate',8:'pinch-rotate'};this._isVertical=null;this._nPreWidth=-1;this._nRotateTimer=null;this._htHandler={};this._htDeviceInfo={};},_getOrientationChangeEvt:function(){var bEvtName='onorientationchange'in window?'orientationchange':'resize';var htInfo=this.getDeviceInfo();if((htInfo.android&&htInfo.version==="2.1")||htInfo.galaxyTab2){bEvtName='resize';}
return bEvtName;},_getVertical:function(){var bVertical=null,sEventType=this._getOrientationChangeEvt();if(sEventType==="resize"){var screenWidth=document.documentElement.clientWidth;if(screenWidth<this._nPreWidth){bVertical=true;}else if(screenWidth==this._nPreWidth){bVertical=this._isVertical;}else{bVertical=false;}
this._nPreWidth=screenWidth;}else{var windowOrientation=window.orientation;if(windowOrientation===0||windowOrientation==180){bVertical=true;}else if(windowOrientation==90||windowOrientation==-90){bVertical=false;}}
return bVertical;},_attachEvent:function(){this._rotateEvent=jindo.$Fn(this._onOrientationChange,this).attach(window,this._getOrientationChangeEvt()).attach(window,"load");this._pageShowEvent=jindo.$Fn(this._onPageshow,this).attach(window,"pageshow");},_initDeviceInfo:function(){var sName=navigator.userAgent;var ar=null;function f(s,h){return((h||"").indexOf(s)>-1);}
this._htDeviceInfo.iphone=f('iPhone',sName);this._htDeviceInfo.ipad=f('iPad',sName);this._htDeviceInfo.android=f('Android',sName);this._htDeviceInfo.galaxyTab=f('SHW-M180S',sName)||f('SHW-M180K',sName)||f('SHW-M180L',sName);this._htDeviceInfo.galaxyTab2=f('SHW-M380S',sName)||f('SHW-M380K',sName);this._htDeviceInfo.galaxyK=f('SHW-M130K',sName);this._htDeviceInfo.galaxyU=f('SHW-M130L',sName);this._htDeviceInfo.galaxyS=f('SHW-M110S',sName)||f('SHW-M110K',sName)||f('SHW-M110L',sName);this._htDeviceInfo.galaxyS2=f('SHW-M250S',sName)||f('SHW-M250K',sName)||f('SHW-M250L',sName);this._htDeviceInfo.version='';this._htDeviceInfo.bChrome=this._htDeviceInfo.android&&(f('CrMo',sName)||f('Chrome',sName));this._htDeviceInfo.bInapp=false;if(this._htDeviceInfo.iphone||this._htDeviceInfo.ipad){ar=sName.match(/OS\s([\d|\_]+\s)/i);if(ar!==null&&ar.length>1){this._htDeviceInfo.version=ar[1];}}else if(this._htDeviceInfo.android){ar=sName.match(/Android\s(\d\.\d)/i);if(ar!==null&&ar.length>1){this._htDeviceInfo.version=ar[1];}}
this._htDeviceInfo.version=this._htDeviceInfo.version.replace(/\_/g,'.');for(var x in this._htDeviceInfo){if(typeof this._htDeviceInfo[x]=="boolean"&&this._htDeviceInfo[x]&&this._htDeviceInfo.hasOwnProperty(x)){this._htDeviceInfo.name=x;}}
if(this._htDeviceInfo.iphone||this._htDeviceInfo.ipad){if(!f('Safari',sName)){this._htDeviceInfo.bInapp=true;}}else if(this._htDeviceInfo.android){sName=sName.toLowerCase();if(f('inapp',sName)||f('app',sName.replace('applewebkit',''))){this._htDeviceInfo.bInapp=true;}}},_onOrientationChange:function(we){var self=this;if(we.type==="load"){this._nPreWidth=document.documentElement.clientWidth;if(!this._htDeviceInfo.bInapp&&(this._htDeviceInfo.iphone||this._htDeviceInfo.ipad)){this._isVertical=this._getVertical();}else{if(this._nPreWidth>document.documentElement.clientHeight){this._isVertical=false;}else{this._isVertical=true;}}
return;}
if(this._getOrientationChangeEvt()==="resize"){setTimeout(function(){self._orientationChange(we);},0);}else{var nTime=200;if(this.getDeviceInfo().android){nTime=500;}
clearTimeout(this._nRotateTimer);this._nRotateTimer=setTimeout(function(){self._orientationChange(we);},nTime);}},_orientationChange:function(we){var nPreVertical=this._isVertical;this._isVertical=this._getVertical();if(jindo.$Agent().navigator().mobile||jindo.$Agent().os().ipad){if(nPreVertical!==this._isVertical){this.fireEvent("mobilerotate",{isVertical:this._isVertical});}}else{this.fireEvent("mobilerotate",{isVertical:this._isVertical});}},bindRotate:function(fHandlerToBind){var aHandler=this._htHandler["mobilerotate"];if(typeof aHandler=='undefined'){aHandler=this._htHandler["mobilerotate"]=[];}
aHandler.push(fHandlerToBind);this.attach("mobilerotate",fHandlerToBind);},unbindRotate:function(fHandlerToUnbind){var aHandler=this._htHandler["mobilerotate"];if(aHandler){for(var i=0,fHandler;(fHandler=aHandler[i]);i++){if(fHandler===fHandlerToUnbind){aHandler.splice(i,1);this.detach("mobilerotate",fHandlerToUnbind);break;}}}},_onPageshow:function(we){var self=this;setTimeout(function(){self.fireEvent("mobilePageshow",{});},300);},bindPageshow:function(fHandlerToBind){var aHandler=this._htHandler["mobilePageshow"];if(typeof aHandler=='undefined'){aHandler=this._htHandler["mobilePageshow"]=[];}
aHandler.push(fHandlerToBind);this.attach("mobilePageshow",fHandlerToBind);},unbindPageshow:function(fHandlerToUnbind){var aHandler=this._htHandler["mobilePageshow"];if(aHandler){for(var i=0,fHandler;(fHandler=aHandler[i]);i++){if(fHandler===fHandlerToUnbind){aHandler.splice(i,1);this.detach("mobilePageshow",fHandlerToUnbind);break;}}}},getDeviceInfo:function(){return this._htDeviceInfo;},isVertical:function(){return this._isVertical;},getNodeElement:function(el){while(el.nodeType!=1){el=el.parentNode;}
return el;},getCssOffset:function(element){var htOffset;if(jindo.m.getDeviceInfo().android&&parseInt(jindo.m.getDeviceInfo().version,10)===3){htOffset=jindo.m._getCssOffsetFromStyle(element);}else{if('WebKitCSSMatrix'in window&&'m11'in new WebKitCSSMatrix()){htOffset=jindo.m._getCssOffsetFromCSSMatrix(element);}else{htOffset=jindo.m._getCssOffsetFromStyle(element);}}
return htOffset;},_getCssOffsetFromStyle:function(element){var nTop=nLeft=0,s=element.style[jindo.m.getCssPrefix()+"Transform"];if(!!s&&s.length>0){aTemp=s.match(/translate.{0,2}\((.*)\)/);if(!!aTemp&&aTemp.length>1){var a=aTemp[1].split(',');if(!!a&&a.length>1){nTop=parseInt(a[1],10);nLeft=parseInt(a[0],10);}}}
return{top:nTop,left:nLeft};},_getCssOffsetFromCSSMatrix:function(element){var curTransform=new WebKitCSSMatrix(window.getComputedStyle(element).webkitTransform);return{top:curTransform.m42,left:curTransform.m41};},attachTransitionEnd:function(element,fHandlerToBind){var nVersion=+jindo.$Jindo().version.replace(/[a-z.]/gi,"");if(nVersion>=151){element._jindo_fn_=jindo.$Fn(fHandlerToBind,this).attach(element,"transitionend");}else{element.addEventListener('webkitTransitionEnd',fHandlerToBind,false);}},detachTransitionEnd:function(element,fHandlerToUnbind){var nVersion=+jindo.$Jindo().version.replace(/[a-z.]/gi,"");if(nVersion>=151){if(element._jindo_fn_){element._jindo_fn_.detach(element,"transitionend");delete element._jindo_fn_;}}else{element.removeEventListener('webkitTransitionEnd',fHandlerToUnbind,false);}},getCssPrefix:function(){var sCssPrefix="";if(typeof document.body.style.MozTransition!=="undefined"){sCssPrefix="Moz";}else if(typeof document.body.style.webkitTransition!=="undefined"){sCssPrefix="webkit";}else if(typeof document.body.style.OTransition!=="undefined"){sCssPrefix="O";}
return sCssPrefix;},getClosest:function(sSelector,elBaseElement){var elClosest;var welBaseElement=jindo.$Element(elBaseElement);var reg=/<\/?(?:h[1-5]|[a-z]+(?:\:[a-z]+)?)[^>]*>/ig;if(reg.test(sSelector)){if("<"+elBaseElement.tagName.toUpperCase()+">"==sSelector.toUpperCase()){elClosest=elBaseElement;}else{elClosest=welBaseElement.parent(function(v){if("<"+v.$value().tagName.toUpperCase()+">"==sSelector.toUpperCase()){return v;}});elClosest=elClosest.length?elClosest[0].$value():false;}}else{if(sSelector.indexOf('.')==0){sSelector=sSelector.substring(1,sSelector.length)}
if(welBaseElement.hasClass(sSelector)){elClosest=elBaseElement;}else{elClosest=welBaseElement.parent(function(v){if(v.hasClass(sSelector)){return v;}});elClosest=elClosest.length?elClosest[0].$value():false;}}
return elClosest;},_getDefaultUseCss3d:function(){if(this._htDeviceInfo.iphone||this._htDeviceInfo.ipad||(this._htDeviceInfo.android&&this._htDeviceInfo.bChrome)){return true;}else{return false;}
return fasle;}}).extend(jindo.Component);return new __M__();})();jindo.UIComponent=jindo.$Class({$init:function(){this._bIsActivating=false;},isActivating:function(){return this._bIsActivating;},activate:function(){if(this.isActivating()){return this;}
this._bIsActivating=true;if(arguments.length>0){this._onActivate.apply(this,arguments);}else{this._onActivate();}
return this;},deactivate:function(){if(!this.isActivating()){return this;}
this._bIsActivating=false;if(arguments.length>0){this._onDeactivate.apply(this,arguments);}else{this._onDeactivate();}
return this;}}).extend(jindo.Component);window.requestAnimationFrame=(function(){return window.requestAnimationFrame||window.webkitRequestAnimationFrame||function(callback){return setTimeout(callback,1);};})();window.cancelRequestAnimationFrame=(function(){return window.cancelRequestAnimationFrame||window.webkitCancelRequestAnimationFrame||clearTimeout;})();jindo.m.CoreScroll=jindo.$Class({$init:function(el,htUserOption){this.option({bActivateOnload:true,bUseHScroll:false,bUseVScroll:true,bUseMomentum:(jindo.m.getDeviceInfo().android?false:true),nDeceleration:0.0006,nOffsetTop:0,nOffsetBottom:0,nHeight:0,nWidth:0,bUseBounce:true,bUseHighlight:true,sClassPrefix:"scroll_",bUseCss3d:jindo.m._getDefaultUseCss3d()});if(typeof htUserOption.bUseTransition!="undefined"){this.option("bUseCss3d",htUserOption.bUseTransition);}
this.option(htUserOption||{});this._initVar();this._setWrapperElement(el);if(this.option("bActivateOnload")){this.activate();}},_initVar:function(){this.isAndroid=jindo.m.getDeviceInfo().android;this.nVersion=parseInt(jindo.m.getDeviceInfo().version,10);this.sCssPrefix=jindo.m.getCssPrefix();this.sTranOpen=null;this.sTranEnd=null;this.nWrapperW=null;this.nWrapperH=null;this.nScrollW=null;this.nScrollH=null;this.nMaxScrollLeft=null;this.nMaxScrollTop=null;this.nMinScrollTop=null;this.bUseHScroll=null;this.bUseVScroll=null;this._oTouch=null;this._nLeft=0;this._nTop=0;this._bUseHighlight=this.option("bUseHighlight");this._aAni=[];this._nAniTimer=null;this._nFixedBugTimer=null;this._isAnimating=false;this._isControling=false;this._isStop=false;this._setTrans();if(this._bUseHighlight){if(this.isAndroid){this._elDummyTag=null;}else{this._aAnchor=null;this._fnDummyFnc=function(){return false;};this._bBlocked=false;}}},_setTrans:function(){if(this.option("bUseCss3d")){this.sTranOpen="3d(";this.sTranEnd=",0)";}else{this.sTranOpen="(";this.sTranEnd=")";}},getCurrentPos:function(){return{nTop:this._nTop,nLeft:this._nLeft};},setLayer:function(el){el=(typeof el=="string"?jindo.$(el):el);this._htWElement["wrapper"]=jindo.$Element(el);this._htWElement["wrapper"].css({"position":"relative","overflow":"hidden"});this.setScroller();},setScroller:function(){this._htWElement["scroller"]=this._htWElement["wrapper"].first();this._htWElement["scroller"].css({"position":"absolute","zIndex":1,"left":0,"top":0}).css(this.sCssPrefix+"TransitionProperty","-webkit-transform").css(this.sCssPrefix+"TransitionDuration",0).css(this.sCssPrefix+"Transform","translate"+this.sTranOpen+"0,0"+this.sTranEnd);if(this.option("bUseCss3d")){this._htWElement["scroller"].css(this.sCssPrefix+"TransitionTimingFunction","cubic-bezier(0.33,0.66,0.66,1)");}
if(this._bUseHighlight&&this.isAndroid&&this.nVersion<3){this._elDummyTag=this._htWElement["scroller"].query("._scroller_dummy_atag_");if(!this._elDummyTag){this._elDummyTag=jindo.$("<a href='javascript:void(0);' class='_scroller_dummy_atag_'></a>");this._elDummyTag.style.position="absolute";this._elDummyTag.style.height="0px";this._elDummyTag.style.width="0px";this._htWElement["scroller"].append(this._elDummyTag);}}},_setWrapperElement:function(el){this._htWElement={};this.setLayer(el);},refresh:function(bNoRepos){if(!this.isActivating()){return;}
if(this.option("nWidth")){this._htWElement["wrapper"].width(parseInt(this.option("nWidth"),10));}
if(this.option("nHeight")){this._htWElement["wrapper"].height(parseInt(this.option("nHeight"),10));}
this.nWrapperW=this._htWElement["wrapper"].width();this.nWrapperH=this._htWElement["wrapper"].height();this.nScrollW=this._htWElement["scroller"].width();this.nScrollH=this._htWElement["scroller"].height()-this.option("nOffsetBottom");this.nMaxScrollLeft=this.nWrapperW-this.nScrollW;this.nMaxScrollTop=this.nWrapperH-this.nScrollH;this.nMinScrollTop=-this.option("nOffsetTop");if(this._bUseHighlight&&!this.isAndroid){this._aAnchor=jindo.$$("A",this._htWElement["scroller"].$value());}
this.bUseHScroll=this.option("bUseHScroll")&&(this.nWrapperW<this.nScrollW);this.bUseVScroll=this.option("bUseVScroll")&&(this.nWrapperH<this.nScrollH);if(this.bUseHScroll&&!this.bUseVScroll){this._htWElement["scroller"].$value().style["height"]="100%";}
if(!this.bUseHScroll&&this.bUseVScroll){this._htWElement["scroller"].$value().style["width"]="100%";}
if(!this.bUseHScroll&&!this.bUseVScroll){this._fixedBugForAndroid();}
if(!bNoRepos){this.restorePos(0);}},_setPos:function(nLeft,nTop){nLeft=this.bUseHScroll?nLeft:0;nTop=this.bUseVScroll?nTop:0;if(this._fireEvent("beforePosition")){this._isControling=true;this._nLeft=nLeft;this._nTop=nTop;if(this._bUseHighlight&&this.isAndroid){var htStyleOffset=this.getStyleOffset(this._htWElement["scroller"]);nLeft-=htStyleOffset.left;nTop-=htStyleOffset.top;}
this._htWElement["scroller"].css(this.sCssPrefix+"Transform","translate"+this.sTranOpen+nLeft+"px, "+nTop+"px"+this.sTranEnd);this._fireEvent("position");}},restorePos:function(nDuration){if(!this.bUseHScroll&&!this.bUseVScroll){return;}
var nNewLeft=this.getPosLeft(this._nLeft),nNewTop=this.getPosTop(this._nTop);if(nNewLeft===this._nLeft&&nNewTop===this._nTop){this._isControling=false;this._fireEvent("afterScroll");this._fixedBugForAndroid();return;}else{this.scrollTo(nNewLeft,nNewTop,nDuration);}},_getMomentum:function(nDistance,nSpeed,nMomentum,nSize,nMaxDistUpper,nMaxDistLower){var nDeceleration=this.option("nDeceleration"),nNewDist=nMomentum/nDeceleration,nNewTime=0,nOutsideDist=0;if(nDistance<0&&nNewDist>nMaxDistUpper){nOutsideDist=nSize/(6/(nNewDist/nSpeed*nDeceleration));nMaxDistUpper=nMaxDistUpper+nOutsideDist;nSpeed=nSpeed*nMaxDistUpper/nNewDist;nNewDist=nMaxDistUpper;}else if(nDistance>0&&nNewDist>nMaxDistLower){nOutsideDist=nSize/(6/(nNewDist/nSpeed*nDeceleration));nMaxDistLower=nMaxDistLower+nOutsideDist;nSpeed=nSpeed*nMaxDistLower/nNewDist;nNewDist=nMaxDistLower;}
nNewDist=nNewDist*(nDistance>0?-1:1);nNewTime=nSpeed/nDeceleration;return{nDist:nNewDist,nTime:Math.round(nNewTime)};},_stop:function(){if(this.option("bUseCss3d")){jindo.m.detachTransitionEnd(this._htWElement["scroller"].$value(),this._htEvent["TransitionEnd"]);}else{cancelRequestAnimationFrame(this._nAniTimer);}
this._aAni=[];this._isAnimating=false;},scrollTo:function(nLeft,nTop,nDuration){this._stop();nLeft=this.bUseHScroll?nLeft:0;nTop=this.bUseVScroll?nTop:0;this._aAni.push({nLeft:nLeft,nTop:nTop,nDuration:nDuration||0});this._animate();},isMoving:function(){return this._isControling;},_animate:function(){var self=this,oStep;if(this._isAnimating){return;}
if(!this._aAni.length){this.restorePos(300);return;}
do{oStep=this._aAni.shift();if(!oStep){return;}}while(oStep.nLeft==this._nLeft&&oStep.nTop==this._nTop);this._isAnimating=true;if(this.option("bUseCss3d")){this._transitionTime(oStep.nDuration);this._setPos(oStep.nLeft,oStep.nTop);this._isAnimating=false;if(oStep.nDuration){jindo.m.attachTransitionEnd(this._htWElement["scroller"].$value(),this._htEvent["TransitionEnd"]);}else{this.restorePos(0);}}else{var startTime=(new Date()).getTime(),nStartLeft=this._nLeft,nStartTop=this._nTop;(function animate(){var now=(new Date()).getTime(),nEaseOut;if(now>=startTime+oStep.nDuration){self._setPos(oStep.nLeft,oStep.nTop);self._isAnimating=false;self._animate();return;}
now=(now-startTime)/oStep.nDuration-1;nEaseOut=Math.sqrt(1-Math.pow(now,2));self._setPos((oStep.nLeft-nStartLeft)*nEaseOut+nStartLeft,(oStep.nTop-nStartTop)*nEaseOut+nStartTop);if(self._isAnimating){self._nAniTimer=requestAnimationFrame(animate);}})();}},_transitionTime:function(nDuration){nDuration+='ms';this._htWElement["scroller"].css(this.sCssPrefix+"TransitionDuration",nDuration);this._fireEventSetDuration(nDuration);},_clearAnchorForIos:function(){if(this._aAnchor&&!this._bBlocked){var aClickAddEvent=null;for(var i=0,nILength=this._aAnchor.length;i<nILength;i++){if(this._fnDummyFnc!==this._aAnchor[i].onclick){this._aAnchor[i]._onclick=this._aAnchor[i].onclick;}
this._aAnchor[i].onclick=this._fnDummyFnc;aClickAddEvent=this._aAnchor[i].___listeners___||[];for(var j=0,nJLength=aClickAddEvent.length;j<nJLength;j++){___Old__removeEventListener___.call(this._aAnchor[i],"click",aClickAddEvent[j].listener,aClickAddEvent[j].useCapture);}}
this._bBlocked=true;}},_restoreAnchorForIos:function(){if(this._aAnchor&&this._bBlocked){var aClickAddEvent=null;for(var i=0,nILength=this._aAnchor.length;i<nILength;i++){if(this._fnDummyFnc!==this._aAnchor[i]._onclick){this._aAnchor[i].onclick=this._aAnchor[i]._onclick;}else{this._aAnchor[i].onclick=null;}
aClickAddEvent=this._aAnchor[i].___listeners___||[];for(var j=0,nJLength=aClickAddEvent.length;j<nJLength;j++){___Old__addEventListener___.call(this._aAnchor[i],"click",aClickAddEvent[j].listener,aClickAddEvent[j].useCapture);}}
this._bBlocked=false;}},_stopScroll:function(){var htCssOffset=jindo.m.getCssOffset(this._htWElement["scroller"].$value()),htStyleOffset={left:0,top:0},nTop,nLeft;if(this._bUseHighlight&&this.isAndroid){htStyleOffset=this.getStyleOffset(this._htWElement["scroller"]);}
nLeft=htCssOffset.left+htStyleOffset.left;nTop=htCssOffset.top+htStyleOffset.top;if(nLeft!==this._nLeft||nTop!==this._nTop){this._stop();this._isStop=true;this._setPos(this.getPosLeft(nLeft),this.getPosTop(nTop));this._isControling=false;this._fireEvent("afterScroll");this._fixedBugForAndroid();}},getStyleOffset:function(wel){var nLeft=parseInt(wel.css("left"),10),nTop=parseInt(wel.css("top"),10);nLeft=isNaN(nLeft)?0:nLeft;nTop=isNaN(nTop)?0:nTop;return{left:nLeft,top:nTop};},getPosLeft:function(nPos){return(nPos>=0?0:(nPos<=this.nMaxScrollLeft?this.nMaxScrollLeft:nPos));},getPosTop:function(nPos){return(nPos>=this.nMinScrollTop?this.nMinScrollTop:(nPos<=this.nMaxScrollTop?this.nMaxScrollTop:nPos));},_fireEventSetDuration:function(nDuration){this.fireEvent("setDuration",{nDuration:nDuration,bUseHScroll:this.bUseHScroll,bUseVScroll:this.bUseVScroll});},_fireEventbeforeScroll:function(htParam){return this.fireEvent("beforeScroll",htParam);},_fireEventScroll:function(htParam){this.fireEvent("scroll",htParam);},_fireEvent:function(sType){return this.fireEvent(sType,{nLeft:this._nLeft,nTop:this._nTop,nMaxScrollLeft:this.nMaxScrollLeft,nMaxScrollTop:this.nMaxScrollTop});},_fireTouchEvent:function(sType,we){return this.fireEvent(sType,{nLeft:this._nLeft,nTop:this._nTop,nMaxScrollLeft:this.nMaxScrollLeft,nMaxScrollTop:this.nMaxScrollTop,oEvent:we});},_onStart:function(we){if(!this.option("bUseHighlight")){we.oEvent.stop(jindo.$Event.DEFAULT_ALL);}
this._clearFixedBug();if(this._fireTouchEvent("beforeTouchStart",we)){this._clearAnchorForIos();this._isAnimating=false;this._isControling=true;this._isStop=false;if(this.option("bUseCss3d")){this._transitionTime(0);}
this._stopScroll();this._oTouch.attach({touchMove:this._htEvent["touchMove"],touchEnd:this._htEvent["touchEnd"]});this._fireTouchEvent("touchStart",we);}},_onMove:function(we){var weParent=we.oEvent;if(we.sMoveType===jindo.m.MOVETYPE[0]){if(this.bUseHScroll){weParent.stop(jindo.$Event.CANCEL_ALL);}else{return true;}}else if(we.sMoveType===jindo.m.MOVETYPE[1]){if(this.bUseVScroll){weParent.stop(jindo.$Event.CANCEL_ALL);}else{return true;}}else if(we.sMoveType===jindo.m.MOVETYPE[2]){weParent.stop(jindo.$Event.CANCEL_ALL);}else{weParent.stop(jindo.$Event.CANCEL_ALL);return true;}
if(this._fireTouchEvent("beforeTouchMove",we)){var nNewLeft,nNewTop;this._clearFixedBug();if(this.option("bUseBounce")){nNewLeft=this._nLeft+(this._nLeft>=0||this._nLeft<=this.nMaxScrollLeft?we.nVectorX/2:we.nVectorX);nNewTop=this._nTop+(this._nTop>=this.nMinScrollTop||this._nTop<=this.nMaxScrollTop?we.nVectorY/2:we.nVectorY);}else{nNewLeft=this.getPosLeft(this._nLeft+we.nVectorX);nNewTop=this.getPosTop(this._nTop+we.nVectorY);}
this._setPos(nNewLeft,nNewTop);this._fireTouchEvent("touchMove",we);}},_onEnd:function(we){if(!this._fireTouchEvent("beforeTouchEnd",we)){return;}
this._clearFixedBug();this._oTouch.detach({touchMove:this._htEvent["touchMove"],touchEnd:this._htEvent["touchEnd"]});if(we.sMoveType===jindo.m.MOVETYPE[0]||we.sMoveType===jindo.m.MOVETYPE[1]||we.sMoveType===jindo.m.MOVETYPE[2]){this._endForScroll(we);we.oEvent.stop(jindo.$Event.CANCEL_DEFAULT);}else{this._isControling=false;if(!this._isStop){if(!this._bUseHighlight){var sTagName=we.element.tagName;if(sTagName!='SELECT'&&sTagName!='INPUT'&&sTagName!='TEXTAREA'){jindo.$Element(we.element).fireEvent("click");}}else{this._restoreAnchorForIos();}}}
this._fireTouchEvent("touchEnd",we);},_endForScroll:function(we){var htMomentumX={nDist:0,nTime:0},htMomentumY={nDist:0,nTime:0},htParam={nMomentumX:we.nMomentumX,nMomentumY:we.nMomentumY,nDistanceX:we.nDistanceX,nDistanceY:we.nDistanceY,nLeft:this._nLeft,nTop:this._nTop};if(this.option("bUseMomentum")&&(we.nMomentumX||we.nMomentumY)){if(this.bUseHScroll){htMomentumX=this._getMomentum(-we.nDistanceX,we.nSpeedX,we.nMomentumX,this.nWrapperW,-this._nLeft,-this.nMaxScrollLeft+this._nLeft);}
if(this.bUseVScroll){htMomentumY=this._getMomentum(-we.nDistanceY,we.nSpeedY,we.nMomentumY,this.nWrapperH,-this._nTop,-this.nMaxScrollTop+this._nTop);}
htParam.nNextLeft=this._nLeft+htMomentumX.nDist;htParam.nNextTop=this._nTop+htMomentumY.nDist;htParam.nTime=Math.max(Math.max(htMomentumX.nTime,htMomentumY.nTime),10);if(this._fireEventbeforeScroll(htParam)){if(this.option("bUseBounce")){this.scrollTo(htParam.nNextLeft,htParam.nNextTop,htParam.nTime);}else{this.scrollTo(this.getPosLeft(htParam.nNextLeft),this.getPosTop(htParam.nNextTop),htParam.nTime);}
this._fireEventScroll(htParam);}}else{htParam.nNextLeft=this._nLeft;htParam.nNextTop=this._nTop;htParam.nTime=0;if(this._fireEventbeforeScroll(htParam)){if(this._nLeft!==htParam.nNextLeft||this._nTop!==htParam.nNextTop){this.scrollTo(htParam.nNextLeft,htParam.nNextTop,htParam.nTime);}else{this.restorePos(300);}
this._fireEventScroll(htParam);}}},_onTransitionEnd:function(we){jindo.m.detachTransitionEnd(this._htWElement["scroller"].$value(),this._htEvent["TransitionEnd"]);this._animate();},_onDocumentStart:function(we){if(this._htWElement["wrapper"].visible()){if(this._htWElement["wrapper"].isChildOf(we.element)){return true;}else{this._stopScroll();}}},_onActivate:function(){if(!this._oTouch){this._oTouch=new jindo.m.Touch(this._htWElement["wrapper"].$value(),{nMoveThreshold:0,nMomentumDuration:(jindo.m.getDeviceInfo().android?500:200),nLongTapDuration:400,nTapThreshold:1,nSlopeThreshold:5});}else{this._oTouch.activate();}
this._attachEvent();this.refresh();},_onDeactivate:function(){this._detachEvent();this._oTouch.deactivate();},_attachEvent:function(){this._htEvent={};this._htEvent["touchStart"]=jindo.$Fn(this._onStart,this).bind();this._htEvent["touchMove"]=jindo.$Fn(this._onMove,this).bind();this._htEvent["touchEnd"]=jindo.$Fn(this._onEnd,this).bind();this._htEvent["TransitionEnd"]=jindo.$Fn(this._onTransitionEnd,this).bind();this._htEvent["document"]=jindo.$Fn(this._onDocumentStart,this).attach(document,"touchstart");this._oTouch.attach("touchStart",this._htEvent["touchStart"]);},_fixedBugForAndroid:function(){if(this._bUseHighlight&&this.isAndroid){var self=this;this._clearFixedBug();this._nFixedBugTimer=setTimeout(function(){if(self._htWElement&&self._htWElement["scroller"]){var ele=self._htWElement["scroller"].$value();var htCssOffset=jindo.m.getCssOffset(ele);var htScrollOffset=self._htWElement["scroller"].offset();ele.style[self.sCssPrefix+"TransitionDuration"]=null;ele.style[self.sCssPrefix+"Transform"]=null;self._htWElement["scroller"].offset(htCssOffset.top+htScrollOffset.top,htCssOffset.left+htScrollOffset.left);if(self.nVersion<3){self._elDummyTag.focus();}}},200);}},_clearFixedBug:function(){if(this._bUseHighlight&&this.isAndroid){clearTimeout(this._nFixedBugTimer);this._nFixedBugTimer=-1;}},_detachEvent:function(){jindo.m.detachTransitionEnd(this._htWElement["scroller"].$value(),this._htEvent["TransitionEnd"]);this._htEvent["document"].detach(document,"touchstart");this._oTouch.detachAll();if(this._elDummyTag){this._htWElement["scroller"].remove(this._elDummyTag);}},destroy:function(){this.deactivate();for(var p in this._htWElement){this._htWElement[p]=null;}
this._htWElement=null;this._oTouch.destroy();delete this._oTouch;}}).extend(jindo.UIComponent);jindo.m.Touch=jindo.$Class({$init:function(sId,htUserOption){this._el=jindo.$(sId);var htDefaultOption={nMomentumDuration:350,nMoveThreshold:7,nSlopeThreshold:25,nLongTapDuration:1000,nDoubleTapDuration:400,nTapThreshold:6,nPinchThreshold:0.1,nRotateThreshold:5,bActivateOnload:true};this.option(htDefaultOption);this.option(htUserOption||{});this._initVariable();this._setSlope();if(this.option("bActivateOnload")){this.activate();}},_initVariable:function(){this._hasTouchEvent='ontouchstart'in window;this._radianToDegree=180/Math.PI;this._htMoveInfo={nStartX:0,nStartY:0,nBeforeX:0,nBeforeY:0,nStartTime:0,nBeforeTime:0,nStartDistance:0,nBeforeDistance:0,nStartAngle:0,nLastAngle:0};this.bStart=false;this.bMove=false;this.nMoveType=-1;this.htEndInfo={};this._nVSlope=0;this._nHSlope=0;this.bSetSlope=false;},_attachEvents:function(){this._htEvent={};var bTouch=this._hasTouchEvent;this._htEvent[bTouch?'touchstart':'mousedown']={ref:jindo.$Fn(this._onStart,this).attach(this._el,(bTouch?'touchstart':'mousedown')),el:this._el};this._htEvent[bTouch?'touchmove':'mousemove']={ref:jindo.$Fn(this._onMove,this).attach(this._el,(bTouch?'touchmove':'mousemove')),el:this._el};this._htEvent[bTouch?'touchend':'mouseup']={ref:jindo.$Fn(this._onEnd,this).attach(this._el,(bTouch?'touchend':'mouseup')),el:this._el};this._htEvent["rotate"]=jindo.$Fn(this._onResize,this).bind();jindo.m.bindRotate(this._htEvent["rotate"]);if(bTouch){this._htEvent['touchcancel']={ref:jindo.$Fn(this._onCancel,this).attach(this._el,'touchcancel'),el:this._el};}},_detachEvents:function(){for(var p in this._htEvent){var htTargetEvent=this._htEvent[p];if(htTargetEvent.ref){htTargetEvent.ref.detach(htTargetEvent.el,p);}}
jindo.m.unbindRotate(this._htEvent["rotate"]);this._htEvent=null;},_onCancel:function(oEvent){this._onEnd(oEvent);},_onStart:function(oEvent){this._resetTouchInfo();var htInfo=this._getTouchInfo(oEvent);var htParam={element:htInfo[0].el,nX:htInfo[0].nX,nY:htInfo[0].nY,oEvent:oEvent};if(!this._fireCustomEvent('touchStart',htParam)){return;}
this.bStart=true;this._htMoveInfo.nStartX=htInfo[0].nX;this._htMoveInfo.nBeforeX=htInfo[0].nX;this._htMoveInfo.nStartY=htInfo[0].nY;this._htMoveInfo.nBeforeY=htInfo[0].nY;this._htMoveInfo.nStartTime=htInfo[0].nTime;this._htMoveInfo.aStartInfo=htInfo;this._startLongTapTimer(htInfo,oEvent);},_onMove:function(oEvent){if(!this.bStart){return;}
this.bMove=true;var htInfo=this._getTouchInfo(oEvent);var htParam=this._getCustomEventParam(htInfo,false);if(htInfo.length===1){if(this.nMoveType<0||this.nMoveType==3||this.nMoveType==4){this.nMoveType=this._getMoveType(htInfo);}}else{if(this.nMoveType!==8){this.nMoveType=this._getMoveType(htInfo);}}
htParam=this._getCustomEventParam(htInfo,false);if((typeof this._nLongTapTimer!='undefined')&&this.nMoveType!=3){this._deleteLongTapTimer();}
htParam.oEvent=oEvent;var nDis=0;if(this.nMoveType==0){nDis=Math.abs(htParam.nVectorX);}else if(this.nMoveType==1){nDis=Math.abs(htParam.nVectorY);}else{nDis=Math.abs(htParam.nVectorX)+Math.abs(htParam.nVectorY);}
if(nDis<this.option('nMoveThreshold')){return;}
if(!this.fireEvent('touchMove',htParam)){this.bStart=false;return;}
this._htMoveInfo.nBeforeX=htInfo[0].nX;this._htMoveInfo.nBeforeY=htInfo[0].nY;this._htMoveInfo.nBeforeTime=htInfo[0].nTime;},_onEnd:function(oEvent){if(!this.bStart){return;}
this._deleteLongTapTimer();if(!this.bMove&&(this.nMoveType!=4)){this.nMoveType=3;}
if(this.nMoveType<0){return;}
var htInfo=this._getTouchInfo(oEvent);if(this._isDblTap(htInfo[0].nX,htInfo[0].nY,htInfo[0].nTime)){clearTimeout(this._nTapTimer);delete this._nTapTimer;this.nMoveType=5;}
var htParam=this._getCustomEventParam(htInfo,true);htParam.oEvent=oEvent;var sMoveType=htParam.sMoveType;if((typeof this._htEventHandler[jindo.m.MOVETYPE[5]]!='undefined'&&(this._htEventHandler[jindo.m.MOVETYPE[5]].length>0))&&(this.nMoveType==3)){var self=this;this._nTapTimer=setTimeout(function(){self.fireEvent('touchEnd',htParam);self._fireCustomEvent(sMoveType,htParam);delete self._nTapTimer;},this.option('nDoubleTapDuration'));}else{this.fireEvent('touchEnd',htParam);if(this.nMoveType!=4){if(this.nMoveType===8){htParam.sMoveType=jindo.m.MOVETYPE[6];this._fireCustomEvent(jindo.m.MOVETYPE[6],htParam);htParam.sMoveType=jindo.m.MOVETYPE[7];this._fireCustomEvent(jindo.m.MOVETYPE[7],htParam);}else{this._fireCustomEvent(sMoveType,htParam);}}}
this._updateTouchEndInfo(htInfo);this._resetTouchInfo();},_fireCustomEvent:function(sEvent,htOption){return this.fireEvent(sEvent,htOption);},_getCustomEventParam:function(htTouchInfo,bTouchEnd){var sMoveType=jindo.m.MOVETYPE[this.nMoveType];var nDuration=htTouchInfo[0].nTime-this._htMoveInfo.nStartTime;var nVectorX=nVectorY=nMomentumX=nMomentumY=nSpeedX=nSpeedY=nDisX=nDisY=0;nDisX=(this.nMoveType===1)?0:htTouchInfo[0].nX-this._htMoveInfo.nStartX;nDisY=(this.nMoveType===0)?0:htTouchInfo[0].nY-this._htMoveInfo.nStartY;nVectorX=htTouchInfo[0].nX-this._htMoveInfo.nBeforeX;nVectorY=htTouchInfo[0].nY-this._htMoveInfo.nBeforeY;if(bTouchEnd&&(this.nMoveType==0||this.nMoveType==1||this.nMoveType==2)){if(nDuration<=this.option('nMomentumDuration')){nSpeedX=Math.abs(nDisX)/nDuration;nMomentumX=(nSpeedX*nSpeedX)/2;nSpeedY=Math.abs(nDisY)/nDuration;nMomentumY=(nSpeedY*nSpeedY)/2;}}
var htParam={element:htTouchInfo[0].el,nX:htTouchInfo[0].nX,nY:htTouchInfo[0].nY,nVectorX:nVectorX,nVectorY:nVectorY,nDistanceX:nDisX,nDistanceY:nDisY,sMoveType:sMoveType,nStartX:this._htMoveInfo.nStartX,nStartY:this._htMoveInfo.nStartY,nStartTimeStamp:this._htMoveInfo.nStartTime};if((htTouchInfo.length)>1||(this.nMoveType>=6)){htParam.nScale=this._getScale(htTouchInfo);htParam.nRotation=this._getRotation(htTouchInfo);if(htParam.nScale===null){htParam.nScale=this._htMoveInfo.nBeforeScale;}
if(htParam.nRotation===null){htParam.nRotation=this._htMoveInfo.nBeforeRotation;}}
if(htTouchInfo.length>=1){var aX=[];var aY=[];var aElement=[];for(var i=0,nLen=htTouchInfo.length;i<nLen;i++){aX.push(htTouchInfo[i].nX);aY.push(htTouchInfo[i].nY);aElement.push(htTouchInfo[i].el);}
htParam.aX=aX;htParam.aY=aY;htParam.aElement=aElement;}
if(bTouchEnd){htParam.nMomentumX=nMomentumX;htParam.nMomentumY=nMomentumY;htParam.nSpeedX=nSpeedX;htParam.nSpeedY=nSpeedY;htParam.nDuration=nDuration;}
return htParam;},_updateTouchEndInfo:function(htInfo){this.htEndInfo={element:htInfo[0].el,time:htInfo[0].nTime,movetype:this.nMoveType,nX:htInfo[0].nX,nY:htInfo[0].nY};},_deleteLongTapTimer:function(){if(typeof this._nLongTapTimer!='undefined'){clearTimeout(this._nLongTapTimer);delete this._nLongTapTimer;}},_startLongTapTimer:function(htInfo,oEvent){var self=this;if((typeof this._htEventHandler[jindo.m.MOVETYPE[4]]!='undefined')&&(this._htEventHandler[jindo.m.MOVETYPE[4]].length>0)){self._nLongTapTimer=setTimeout(function(){self.fireEvent('longTap',{element:htInfo[0].el,oEvent:oEvent,nX:htInfo[0].nX,nY:htInfo[0].nY});delete self._nLongTapTimer;self.nMoveType=4;},self.option('nLongTapDuration'));}},_onResize:function(){this._setSlope();},_isDblTap:function(nX,nY,nTime){if((typeof this._nTapTimer!='undefined')&&this.nMoveType==3){var nGap=this.option('nTapThreshold');if((Math.abs(this.htEndInfo.nX-nX)<=nGap)&&(Math.abs(this.htEndInfo.nY-nY)<=nGap)){return true;}}
return false;},_setSlope:function(){if(!this.bSetSlope){this._nHSlope=((window.innerHeight/2)/window.innerWidth).toFixed(2)*1;this._nVSlope=(window.innerHeight/(window.innerWidth/2)).toFixed(2)*1;}},setSlope:function(nVSlope,nHSlope){this._nHSlope=nHSlope;this._nVSlope=nVSlope;this.bSetSlope=true;},getSlope:function(){return{nVSlope:this._nVSlope,nHSlope:this._nHSlope}},_resetTouchInfo:function(){for(var x in this._htMoveInfo){this._htMoveInfo[x]=0;}
this._deleteLongTapTimer();this.bStart=false;this.bMove=false;this.nMoveType=-1;},_getMoveTypeBySingle:function(x,y){var nType=this.nMoveType;var nX=Math.abs(this._htMoveInfo.nStartX-x);var nY=Math.abs(this._htMoveInfo.nStartY-y);var nDis=nX+nY;var nGap=this.option('nTapThreshold');if((nX<=nGap)&&(nY<=nGap)){nType=3;}else{nType=-1;}
if(this.option('nSlopeThreshold')<=nDis){var nSlope=parseFloat((nY/nX).toFixed(2),10);if((this._nHSlope===-1)&&(this._nVSlope===-1)){nType=2;}else{if(nSlope<=this._nHSlope){nType=0;}else if(nSlope>=this._nVSlope){nType=1;}else{nType=2;}}}
return nType;},_getMoveTypeByMulti:function(aPos){var nType=-1;if((this.nMoveType===6)||Math.abs(1-this._htMoveInfo.nBeforeScale)>=this.option('nPinchThreshold')){nType=6;}
if((this.nMoveType===7)||Math.abs(0-this._htMoveInfo.nBeforeRotation)>=this.option('nRotateThreshold')){if(nType===6){nType=8;}else{nType=7;}}
if(nType===-1){return this.nMoveType;}
return nType;},_getScale:function(aPos){var nScale=-1;var nDistance=this._getDistance(aPos);if(nDistance<=0){return null;}
if(this._htMoveInfo.nStartDistance===0){nScale=1;this._htMoveInfo.nStartDistance=nDistance;}else{nScale=nDistance/this._htMoveInfo.nStartDistance;}
this._htMoveInfo.nBeforeScale=nScale;return nScale;},_getRotation:function(aPos){var nRotation=-1;var nAngle=this._getAngle(aPos);if(nAngle===null){return null;}
if(this._htMoveInfo.nStartAngle===0){this._htMoveInfo.nStartAngle=nAngle;nRotation=0;}else{nRotation=nAngle-this._htMoveInfo.nStartAngle;}
this._htMoveInfo.nLastAngle=nAngle;this._htMoveInfo.nBeforeRotation=nRotation;return nRotation;},_getMoveType:function(aPos){var nType=this.nMoveType;if(aPos.length===1){nType=this._getMoveTypeBySingle(aPos[0].nX,aPos[0].nY);}else if(aPos.length===2){nType=this._getMoveTypeByMulti(aPos);}
return nType;},_getDistance:function(aPos){if(aPos.length===1){return-1;}
return Math.sqrt(Math.pow(Math.abs(aPos[0].nX-aPos[1].nX),2)+
Math.pow(Math.abs(aPos[0].nY-aPos[1].nY),2));},_getAngle:function(aPos){if(aPos.length===1){return null;}
var deltaX=aPos[0].nX-aPos[1].nX,deltaY=aPos[0].nY-aPos[1].nY;var nAngle=Math.atan2(deltaY,deltaX)*this._radianToDegree;if(this._htMoveInfo.nLastAngle!==null){var nDiff=Math.abs(this._htMoveInfo.nLastAngle-nAngle);var nNext=nAngle+360;var nPrev=nAngle-360;if(Math.abs(nNext-this._htMoveInfo.nLastAngle)<nDiff){nAngle=nNext;}else if(Math.abs(nPrev-this._htMoveInfo.nLastAngle)<nDiff){nAngle=nPrev;}}
return nAngle;},_getTouchInfo:function(oEvent){var aReturn=[];var nTime=oEvent.$value().timeStamp;if(this._hasTouchEvent){var oTouch=oEvent.$value().changedTouches;for(var i=0,nLen=oTouch.length;i<nLen;i++){aReturn.push({el:jindo.m.getNodeElement(oTouch[i].target),nX:oTouch[i].pageX,nY:oTouch[i].pageY,nTime:nTime});}}else{aReturn.push({el:oEvent.element,nX:oEvent.pos().pageX,nY:oEvent.pos().pageY,nTime:nTime});}
return aReturn;},getBaseElement:function(el){return this._el;},_onDeactivate:function(){this._detachEvents();},_onActivate:function(){this._attachEvents();},destroy:function(){this.deactivate();this._el=null;for(var p in this._htMoveInfo){this._htMoveInfo[p]=null;}
this._htMoveInfo=null;for(var p in this.htEndInfo){this.htEndInfo[p]=null;}
this.htEndInfo=null;this.bStart=null;this.bMove=null;this.nMoveType=null;this._nVSlope=null;this._nHSlope=null;this.bSetSlope=null;}}).extend(jindo.UIComponent);jindo.m.Flicking=jindo.$Class({$init:function(sId,htUserOption){this.option({bHorizontal:true,sClassPrefix:'flick-',bActivateOnload:true,nDefaultIndex:0,bAutoResize:true,bAutoSize:true,nFlickThreshold:40,nDuration:200,nFlickDistanceOffset:null,bUseCss3d:jindo.m._getDefaultUseCss3d()});this.option(htUserOption||{});this._setWrapperElement(sId);this._initVar();this._setSize();this._initScroll();this._updateSizeInfo();if(this.option("bActivateOnload")){this.activate();this.moveTo(this.option('nDefaultIndex'),0);}},_initScroll:function(){this._oCore=new jindo.m.CoreScroll(this._htWElement.base.$value(),{bUseHScroll:this.option('bHorizontal'),bUseVScroll:!this.option('bHorizontal'),bUseMomentum:false,bUseCss3d:this.option('bUseCss3d'),bActivateOnload:false});this._oCore.attach({'beforeScroll':jindo.$Fn(this._onBeforeScrollEnd,this).bind(),'afterScroll':jindo.$Fn(this._onScrollEnd,this).bind(),'beforeTouchStart':jindo.$Fn(this._onBeforeTouchStart,this).bind(),'beforeTouchMove':jindo.$Fn(this._onBeforeTouchMove,this).bind(),'beforeTouchEnd':jindo.$Fn(this._onBeforeTouchMove,this).bind()});},_initVar:function(){this.bHorizontal=(this.option('bHorizontal'))?true:false;this.nCurrentIndex=this.option('nDefaultIndex');this.nNextIndex=this.nCurrentIndex;this.bResizeing=false;},_setWrapperElement:function(el){this._htWElement={};el=jindo.$(el);var sClass='.'+this.option('sClassPrefix');this._htWElement.base=jindo.$Element(el);this._htWElement.wrapper=jindo.$Element(jindo.$$.getSingle(sClass+'container',el));var aContents=jindo.$$(sClass+"ct",el);this._htWElement.aContent=jindo.$A(aContents).forEach(function(value,index,array){array[index]=jindo.$Element(value);}).$value();},_setSize:function(){if(!this.option('bAutoSize'))return;var nLen=this._htWElement.aContent.length;if(this.bHorizontal){var nW=this._htWElement.base.width();this._htWElement.wrapper.width(nW*nLen);jindo.$A(this._htWElement.aContent).forEach(function(value){value.width(nW);});}else{var nH=this._htWElement.aContent[0].height();this._htWElement.wrapper.height(nH*nLen);}},_updateSizeInfo:function(){var sLen=this.bHorizontal?'width':'height';var sOff=this.bHorizontal?'left':'top';this._htPosition=[];var nPos=0;var nBeforePos=0;for(var i=0,nLen=this._htWElement.aContent.length;i<nLen;i++){if(i!=0){if(this.option('nFlickDistanceOffset')===null){nPos+=this._htWElement.aContent[i-1][sLen]()*-1;}else{var nW=this._htWElement.aContent[i-1][sLen]()*-1;nPos=nBeforePos+nW+(this.option('nFlickDistanceOffset')*-1);nBeforePos+=nW;}}
this._htPosition.push(nPos);}},_onBeforeTouchStart:function(oCustomEvt){if(!this.fireEvent('touchStart',{element:oCustomEvt.oEvent.element,nX:oCustomEvt.oEvent.nX,nY:oCustomEvt.oEvent.nY,oEvent:oCustomEvt.oEvent.oEvent})){oCustomEvt.stop();}},_onBeforeTouchMove:function(oCustomEvt){var sType=(oCustomEvt.sType.indexOf('End')>-1)?"touchEnd":"touchMove";var htParam={};for(var p in oCustomEvt.oEvent){if(typeof oCustomEvt.oEvent[p]!=='object'&&typeof oCustomEvt.oEvent[p]!=='function'){htParam[p]=oCustomEvt.oEvent[p];}}
htParam['sType']=sType;this.fireEvent(sType,htParam);},_onBeforeScrollEnd:function(oCustomEvt){var nOrignalTime=oCustomEvt.nTime;var htPos=this._getSnap(oCustomEvt.nLeft,oCustomEvt.nTop,oCustomEvt.nDistanceX,oCustomEvt.nDistanceY,oCustomEvt.nMomentumX,oCustomEvt.nMomentumY);oCustomEvt.nNextLeft=htPos.nX;oCustomEvt.nNextTop=htPos.nY;oCustomEvt.nTime=htPos.nTime;if(!this.fireEvent('beforeFlicking',{nContentsIndex:this.getContentIndex(),nContentsNextIndex:htPos.nIndex})){oCustomEvt.stop();return;}
this.nNextIndex=htPos.nIndex;},_onScrollEnd:function(){if(!this.bResizeing&&(this.nNextIndex!=this.nCurrentIndex)){this._setContentIndex(this.nNextIndex);this.fireEvent('afterFlicking',{nContentsIndex:this.getContentIndex()});}
if(this.bResizeing){this.bResizeing=false;}},_getSnap:function(nX,nY,nDisX,nDisY,nMomX,nMomY){var nPosX=nPosY=nNewPos=0;var nIndex=this._htWElement.aContent.length-1;var nCurrent=this.bHorizontal?nX:nY;var nDis=this.bHorizontal?nDisX:nDisY;var nMom=this.bHorizontal?nMomX:nMomY;for(var i=0,nLen=this._htPosition.length;i<nLen;i++){if(nCurrent>=(this._htPosition[i])){nIndex=i;break;}}
if(nIndex==this.nCurrentIndex&&nIndex>0&&nDis>0)nIndex--;if((Math.abs(nDis)<=this.option('nFlickThreshold'))){if(!(!jindo.m.getDeviceInfo().android&&nMom!=0)){nIndex=this.nCurrentIndex;}}
nNewPos=this._htPosition[nIndex];var nSize=Math.abs(this._htPosition[nIndex]-this._htPosition[this.nCurrentIndex]);var nGap=nSize?Math.abs((nNewPos-nCurrent)/nSize):0;var nTime=(!jindo.m.getDeviceInfo().android&&(nMom!=0))?Math.round(this.option('nDuration')*nGap*0.5):this.option('nDuration');nTime=Math.min(nTime,this.option('nDuration'));return{nX:this.bHorizontal?nNewPos:nPosX,nY:this.bHorizontal?nPosY:nNewPos,nTime:Math.round(nTime),nIndex:nIndex}},_getPosition:function(nIndex){var nPosX=nPosY=0;if(typeof nIndex=='undefined'){nIndex=this.nCurrentIndex;}
nIndex=Math.max(0,nIndex);nIndex=Math.min(this._htPosition.length-1,nIndex);return{nX:this.bHorizontal?this._htPosition[nIndex]:nPosX,nY:this.bHorizontal?nPosY:this._htPosition[nIndex]}},_setContentIndex:function(nIndex){this.nCurrentIndex=nIndex;},getContentIndex:function(){return this.nCurrentIndex;},getContentElement:function(){return this._htWElement.aContent[this.getContentIndex()];},getTotalContents:function(){return this._htWElement.aContent.length;},getPrevIndex:function(){return Math.max(this.nCurrentIndex-1,0);},getPrevElement:function(){if(this.nCurrentIndex-1<0){return null;}else{return this._htWElement.aContent[this.nCurrentIndex-1];}},getNextIndex:function(){return Math.min(this.nCurrentIndex+1,this._htWElement.aContent.length-1);},getNextElement:function(){if(this.nCurrentIndex+1>this._htWElement.aContent.length-1){return null;}else{return this._htWElement.aContent[this.nCurrentIndex+1];}},moveTo:function(nIndex,nTime){if(nIndex<0||nIndex>this._htWElement.aContent.length-1){return;}
if(typeof nTime=='undefined'){nTime=this.option('nDuration');}
var htPos=this._getPosition(nIndex);this.nNextIndex=nIndex;var htCurPos=this._oCore.getCurrentPos();if((htPos.nY!==htCurPos.nTop)||(htPos.nX!==htCurPos.nLeft)){this._oCore.scrollTo(htPos.nX,htPos.nY,nTime);}else{this._onScrollEnd();}},movePrev:function(nTime){this.moveTo(this.getPrevIndex(),nTime);},moveNext:function(nTime){this.moveTo(this.getNextIndex(),nTime);},isAnimating:function(){return this._oCore.isMoving();},_onResize:function(evt){if(!this.option('bAutoResize'))return;this.refresh();},refresh:function(nIndex,bResize){if(typeof bResize==='undefined'){bResize=true;}
if(typeof nIndex==='undefined'){nIndex=this.nCurrentIndex;}
if(bResize){this._setSize();this._updateSizeInfo();this._oCore.refresh(true);this.bResizeing=true;}
this.moveTo(nIndex,0);},_onActivate:function(){this._oCore.activate();this._attachEvent();},_onDeactivate:function(){this._oCore.deactivate();this._detachEvent();},_attachEvent:function(){this._htEvent={};this._htEvent["rotate"]=jindo.$Fn(this._onResize,this).bind();jindo.m.bindRotate(this._htEvent["rotate"]);},_detachEvent:function(){for(p in this._htEvent){var htTargetEvent=this._htEvent[p];if(htTargetEvent.ref){htTargetEvent.ref.detach(htTargetEvent.el,p);}}
jindo.m.unbindRotate(this._htEvent["rotate"]);this._htEvent=null;},destroy:function(){this.deactivate();this._oCore.destroy();delete this._oCore;for(var p in this._htWElement){this._htWElement[p]=null;}
this._htWElement=null;this.bHorizontal=null;this.nCurrentIndex=null;this._htPosition=null;}}).extend(jindo.UIComponent);